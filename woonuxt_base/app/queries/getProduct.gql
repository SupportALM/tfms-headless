query getProduct($slug: ID!) {
  product(id: $slug, idType: SLUG) {
    id
    productId: databaseId
    name
    description
    rawDescription: description(format: RAW)
    shortDescription
    ... on ProductWithAttributes {
      # attributes field removed due to schema mismatch
    }
    ... on VariableProduct {
      # attributes field removed due to schema mismatch
      # defaultAttributes block removed due to schema mismatch
    }
    ...ProductCategories
    ...Terms
    ...SimpleProduct
    ...ExternalProduct
    related(first: 5) {
      nodes {
        ...ShortProduct
      }
    }
    upsell(first: 5) {
      nodes {
        ...ShortProduct
      }
    }
    crossSell(first: 5) {
      nodes {
        ...ShortProduct
      }
    }
    ... on NodeWithFeaturedImage {
      image {
        ...Image
      }
    }
    galleryImages {
      nodes {
        ...Image
      }
    }
  }
}

fragment ProductCategories on Product {
  productCategories {
    nodes {
      id
      name
      slug
    }
  }
}

fragment SimpleProduct on SimpleProduct {
  price(format: RAW)
  regularPrice(format: RAW)
  salePrice(format: RAW)
  stockStatus
  stockQuantity
  onSale
  manageStock
  image {
    ...Image
  }
}

fragment VariableProduct on VariableProduct {
  price(format: RAW)
  regularPrice(format: RAW)
  salePrice(format: RAW)
  stockStatus
  stockQuantity
  onSale
  manageStock
  image {
    ...Image
  }
  variations {
    nodes {
      id
      databaseId
      name
      description
      price(format: RAW)
      regularPrice(format: RAW)
      salePrice(format: RAW)
      onSale
      stockStatus
      stockQuantity
      image {
        ...Image
      }
      attributes {
        nodes {
          id
          name
          value
          attributeId
        }
      }
    }
  }
}

fragment ExternalProduct on ExternalProduct {
  price(format: RAW)
  regularPrice(format: RAW)
  salePrice(format: RAW)
  buttonText
  externalUrl
}

fragment ShortProduct on Product {
  id
  databaseId
  name
  slug
  ... on NodeWithFeaturedImage {
    image {
      id
      sourceUrl(size: WOOCOMMERCE_THUMBNAIL)
      altText
    }
  }
  ... on SimpleProduct {
    price(format: RAW)
    regularPrice(format: RAW)
    salePrice(format: RAW)
    stockStatus
    stockQuantity
    onSale
  }
  ... on VariableProduct {
    price(format: RAW)
    regularPrice(format: RAW)
    salePrice(format: RAW)
    stockStatus
    stockQuantity
    onSale
  }
  ... on ExternalProduct {
    price(format: RAW)
    regularPrice(format: RAW)
    salePrice(format: RAW)
  }
  ... on GroupProduct {
    products {
      nodes {
        ... on SimpleProduct {
          price(format: RAW)
          regularPrice(format: RAW)
          salePrice(format: RAW)
        }
      }
    }
  }
}

fragment Terms on Product {
  terms {
    nodes {
      id
      name
      slug
      taxonomyName
    }
  }
}

# fragment ProductWithAttributes on ProductWithAttributes {
#   # Removing this fragment content as attributes query caused errors
# }
